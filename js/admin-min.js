"use strict";var sln_importRows;function sln_initImporter(e,n){var t=e;function a(e,o){var l=((e=parseInt(e))-(o=parseInt(o)))/e*100;t.find(".progress-bar").attr("aria-valuenow",l).css("width",l+"%"),0!=o?jQuery.ajax({url:ajaxurl,type:"GET",data:{action:"salon",method:"import"+n,step:"process",_wpnonce:jQuery("input#_wpnonce").val()},cache:!1,dataType:"json",success:function(e){e.success?(console.log(e),a(e.data.total,e.data.left)):s()},error:function(){s()}}):jQuery.ajax({url:ajaxurl,type:"POST",data:{action:"salon",method:"import"+n,step:"finish",_wpnonce:jQuery("input#_wpnonce").val()},cache:!1,dataType:"json",success:function(e){e.success?(t.find(".info, .alert, .progress-wrapper").addClass("hide"),t.find(".alert-success").removeClass("hide"),t.removeClass("drop")):s()},error:function(){s()}})}function s(){t.find(".alert, .progress-wrapper").addClass("hide"),t.find(".alert-danger").removeClass("hide"),t.removeClass("drop")}t[0].ondragover=function(){return t.addClass("hover"),!1},t[0].ondragleave=function(){return t.removeClass("hover"),!1},t[0].ondrop=function(e){e.preventDefault(),t.removeClass("hover").addClass("drop");var n=e.dataTransfer.files[0];t.file=n,t.find(".text").html(n.name),t.removeClass("is_loading"),t.find(".alert, .progress-wrapper").addClass("hide"),t.find(".info").removeClass("hide")},jQuery("[data-action=sln_import][data-target="+t.attr("id")+"]").on("click",(function(){var e=jQuery(this);if(e.button("loading"),jQuery(this).parent().parent().addClass("is_loading"),!t.file)return e.button("reset"),jQuery(this).parent().parent().removeClass("is_loading"),!1;t.find(".progress-bar").attr("aria-valuenow",0).css("width","0%"),t.find(".text").html(t.find(".text").attr("placeholder")),t.removeClass("is_loading"),t.find(".alert, .progress-wrapper").addClass("hide"),t.find(".info").removeClass("hide");var o=new FormData;return o.append("action","salon"),o.append("method","import"+n),o.append("step","start"),o.append("_wpnonce",jQuery("input#_wpnonce").val()),o.append("file",t.file),jQuery.ajax({url:ajaxurl,type:"POST",data:o,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(o){if(e.button("reset"),o.success){console.log(o),sln_importRows=o.data.rows;var l=jQuery("#import-matching-modal"),i=l.find("[data-action=sln_import_matching]");i.button("reset"),l.find("table tbody").html(o.data.matching),jQuery("#wpwrap").css("z-index","auto"),l.modal({keyboard:!1,backdrop:!0}),sln_createSelect2Full(jQuery),sln_validImportMatching(),l.find("[data-action=sln_import_matching_select]").on("change",sln_changeImportMatching),jQuery("[data-action=sln_import_matching]").off("click").on("click",(function(){if(!sln_validImportMatching())return!1;i.button("loading"),jQuery.ajax({url:ajaxurl,type:"POST",data:{action:"salon",method:"import"+n,step:"matching",_wpnonce:jQuery("input#_wpnonce").val(),form:l.closest("form").serialize()},cache:!1,dataType:"json",success:function(e){console.log(e),l.modal("hide"),e.success?(t.find(".info, .alert").addClass("hide"),t.find(".progress-wrapper").removeClass("hide"),t.removeClass("drop"),a(e.data.total,e.data.left)):s()},error:function(){l.modal("hide"),s()}})}))}else s()},error:function(){e.button("reset"),s()}}),t.file=!1,!1}))}function sln_changeImportMatching(){var e=jQuery(this),n=e.val(),t=e.attr("data-col");e.closest("table").find("tr.import_matching").each((function(e,a){var s=jQuery(this).find("td[data-col="+t+"] span");void 0!==sln_importRows[e]&&void 0!==sln_importRows[e][n]?s.addClass("pull-left").removeClass("half-opacity").html(sln_importRows[e][n]):s.removeClass("pull-left").addClass("half-opacity").html(s.closest("td").attr("placeholder"))})),sln_validImportMatching()}function sln_validImportMatching(){var e=jQuery("#import-matching-modal"),n=!0;return e.find("select").each((function(){jQuery(this).prop("required")&&""==jQuery(this).val()&&(n=!1)})),n?(e.find(".alert").addClass("hide"),e.find("[data-action=sln_import_matching]").prop("disabled",!1)):(e.find(".alert").removeClass("hide"),e.find("[data-action=sln_import_matching]").prop("disabled","disabled")),n}jQuery("#toplevel_page_salon").hasClass("wp-menu-open")&&(jQuery("#wpbody-content .wrap").addClass("sln-bootstrap"),jQuery("#wpbody-content .wrap").attr("id","sln-salon--admin")),function(e,n,t,a,s){var o,l,i,r,d;for((s=e[a]=e[a]||{})._q=s._q||[],l=0,i=(o=["initialize","identify","updateOptions","pageLoad","track"]).length;l<i;++l)!function(e){s[e]=s[e]||function(){s._q[e===o[0]?"unshift":"push"]([e].concat([].slice.call(arguments,0)))}}(o[l]);(r=n.createElement(t)).async=!0,r.src="https://cdn.pendo.io/agent/static/24521e10-d113-4085-71a3-b7808fddc272/pendo.js",(d=n.getElementsByTagName(t)[0]).parentNode.insertBefore(r,d)}(window,document,"script","pendo"),"undefined"!=typeof sln_pendo_user_id&&pendo.initialize({visitor:{id:sln_pendo_user_id,paidOrTrialUser:sln_pendo_paid_or_trail_user},account:{id:sln_pendo_account_id}}),jQuery((function($){var e,n,t,a;if(window.frameElement&&$("html").addClass("in-iframe"),$("#booking-accept, #booking-refuse").on("click",(function(){$("#_sln_booking_status").val($(this).data("status")),$("#save-post").trigger("click")})),$(".sln-toolbox-trigger").on("click",(function(e){$(this).parent().toggleClass("open"),e.preventDefault()})),$(".sln-toolbox-trigger-mob").on("click",(function(e){$(this).parent().find(".sln-toolbox").toggleClass("open"),e.preventDefault()})),$(".sln-box-info-trigger button").on("click",(function(e){$(this).parent().parent().parent().toggleClass("sln-box--info-visible"),e.preventDefault()})),$(".sln-box-info-content:after").on("click",(function(e){e.preventDefault()})),$(".sln-admin-sidebar").length&&$(".sln-admin-sidebar").affix({offset:{top:$(".sln-admin-sidebar").offset().top-96}}),$(".sln-notice__dismiss").on("click",(function(){$(this).closest(".sln-notice__wrapper").hide(),document.cookie="sln-notice__dismiss=1"})),$("[data-action=change-service-type]").on("change",(function(){var e=$(this),n=$(e.attr("data-target")),t=$("#exclusive_service");e.is(":checked")?(n.removeClass("hide"),t.addClass("hide"),$("#_sln_service_exclusive").val(0)):(n.addClass("hide"),t.removeClass("hide"))})),$("[data-action=change-secondary-service-mode]").on("change",(function(){var e=$(this),n=$(e.attr("data-target"));"service"===e.val()?n.removeClass("hide"):n.addClass("hide")})),$(".sln-radiobox__wrapper--bd").each((function(){var e=$(this).find('input[type="radio"]');e.prop("checked")&&$(this).addClass("sln-radiobox__wrapper--checked"),e.on("change",(function(){$(".sln-radiobox__wrapper--bd").removeClass("sln-radiobox__wrapper--checked"),$(this).parent().parent().addClass("sln-radiobox__wrapper--checked")}))})),$("#sln-salon--admin.sln-calendar--wrapper--loading").length&&($(".sln-calendar--wrapper--sub").css("opacity","1"),$(".sln-calendar--wrapper").removeClass("sln-calendar--wrapper--loading sln-calendar--wrapper")),$(".sln-calendar--wrapper").length&&($(".sln-calendar--wrapper--sub").css("opacity","1"),$(".sln-calendar--wrapper").removeClass("sln-calendar--wrapper--loading")),$(window).width()<1024&&$(".sln-admin-banner--trigger, .sln-admin-banner--close").on("click",(function(e){$(".sln-admin-banner").toggleClass("sln-admin-banner--inview"),e.preventDefault()})),$("#import-customers-drag").length>0&&sln_initImporter($("#import-customers-drag"),"Customers"),$("#import-services-drag").length>0&&sln_initImporter($("#import-services-drag"),"Services"),$("#import-assistants-drag").length>0&&sln_initImporter($("#import-assistants-drag"),"Assistants"),$("#import-category-drag").length&&sln_initImporter($("#import-category-drag"),"Category"),$("#import-bookings-drag").length&&sln_initImporter($("#import-bookings-drag"),"Bookings"),$("#_sln_service_price").on("sln_add_error_tip",(function(e,n,t){var a=n.position();0===n.parent().find(".sln_error_tip").length&&(n.after('<div class="sln_error_tip '+t+'">'+salon_admin[t]+"</div>"),n.parent().find(".sln_error_tip").css("left",a.left+n.width()-n.width()/2-$(".sln_error_tip").width()/2).css("top",a.top+n.height()).fadeIn("100"))})).on("sln_remove_error_tip",(function(e,n,t){n.parent().find(".sln_error_tip."+t).fadeOut("100",(function(){$(this).remove()}))})).on("blur",(function(){$(".sln_error_tip").fadeOut("100",(function(){$(this).remove()}))})).on("change",(function(){var e=new RegExp("[^-0-9%\\"+salon_admin.mon_decimal_point+"]+","gi"),n=$(this).val(),t=n.replace(e,"");n!==t&&$(this).val(t)})).on("keyup",(function(){var e,n;e=new RegExp("[^-0-9%\\"+salon_admin.mon_decimal_point+"]+","gi"),n="i18n_mon_decimal_error";var t=$(this).val(),a=t.replace(e,"");t!==a?$("#_sln_service_price").triggerHandler("sln_add_error_tip",[$(this),n]):$("#_sln_service_price").triggerHandler("sln_remove_error_tip",[$(this),n])})),$("#salon_settings_sms_provider").on("change",(function(){$("#salon_settings_whatsapp_enabled").prop("checked",!1),$(".enabled-whatsapp-checkbox").toggleClass("hide","twilio"!==$(this).val())})),$(".sln-box--haspanel").length&&($(".sln-box--haspanel").each((function(){var e=$(this).find(".sln-box__paneltitle"),n=$(this).find(".sln-box__panelcollapse");e.on("click",(function(){$(".sln-box--haspanel .sln-box__paneltitle").removeClass("sln-box__paneltitle--open"),$(".sln-box--haspanel .sln-box__panelcollapse.in").collapse("hide"),n.collapse("toggle")})),n.on("hidden.bs.collapse",(function(){var n=$(this).parent().attr("id");$("a[href$='#"+n+"']").parent().removeClass("active"),e.removeClass("sln-box__paneltitle--open"),$(this).parent().removeClass("sln-box--haspanel--open")})),n.on("show.bs.collapse",(function(){var n=$(this).parent().attr("id"),t=$("a[href$='#"+n+"']").parent(),a=$("a[href$='#"+n+"']").attr("data-initialOffset");$(".sln-inpage_navbar_inner").scrollLeft(a-10),$("#sln-inpage_navbar li").removeClass("active"),t.addClass("active"),console.log(n+" "+t),e.addClass("sln-box__paneltitle--open"),$(this).parent().addClass("sln-box--haspanel--open")}))})),$("#salon_settings_enable_booking_tax_calculation").on("change",(function(){$(this).closest(".row").next().toggleClass("hide",$(this).val())})),setTimeout((function(){window.location.hash&&($("#"+window.location.hash.replace("#","")+" .sln-box__paneltitle").trigger("click"),$([document.documentElement,document.body]).animate({scrollTop:$("#"+window.location.hash.replace("#","")).offset().top},2e3))}),0)),$("#salon_settings_attendant_enabled").on("change",(function(){$(".only-from-backend-attendant-enable-checkbox, .assistant-selections-options").toggleClass("hide",!$(this).prop("checked")),$(this).closest(".row").toggleClass("sln-box--appeared",$(this).prop("checked"))})),$(".sln-booking-holiday-rules").on("change",".sln-from-date .sln-input",(function(){$(this).closest(".row").find(".sln-to-date .sln-input").val($(this).val())})),$("#_sln_attendant_email").select2({containerCssClass:"sln-select-rendered",dropdownCssClass:"sln-select-dropdown",theme:"sln",width:"100%",placeholder:$("#_sln_attendant_email").data("placeholder"),tags:!0,allowClear:!0,language:{noResults:function(){return $("#_sln_attendant_email").data("nomatches")}},ajax:{url:salon.ajax_url+"&action=salon&method=SearchAssistantStaffMember&security="+salon.ajax_nonce,dataType:"json",delay:250,data:function(e){return{s:e.term}},minimumInputLength:3,processResults:function(e,n){let t=$("#_sln_attendant_email :first-child");return""==t.data("staff-member-id")&&e.result.forEach((function(e){if(t.val()==e.id)return t.data("staff-member-id",e.staff_member_id),!1})),{results:e.result}}}}),$("#_sln_attendant_email").on("change",(function(){var e=$("#_sln_attendant_email").select2("data")[0],n=void 0!==e?e.staff_member_id||$(e.element).data("staff-member-id"):"";$('[name="_sln_attendant_staff_member_id"]').val(n),$('[name="_sln_attendant_limit_staff_member_to_assigned_bookings_only"]').prop("checked",!1),$('[name="_sln_attendant_limit_staff_member_to_backend_calendar_only"]').prop("checked",!1),+n?($(".sln-staff-member-assigned-bookings-only").removeClass("hide"),$(".sln-staff-member-backend-calendar-only").removeClass("hide")):($(".sln-staff-member-assigned-bookings-only").addClass("hide"),$(".sln-staff-member-backend-calendar-only").addClass("hide"))})),$('input[type="tel"]').on("keydown",(function(e){/[^0-9]/.test(e.key)&&!/(Backspace)|(Enter)|(Tab)|(ArrowLeft)|(ArrowRight)|(Delete)/.test(e.key)&&e.preventDefault()})),(a=document.querySelector("#sln_customer_meta__sln_phone"))&&$("#sln_customer_meta__sln_sms_prefix").length){var s=window.intlTelInput(a,{initialCountry:(e=($("#sln_customer_meta__sln_sms_prefix").val()||"").replace("+",""),n=window.intlTelInputGlobals.getCountryData(),t="",n.forEach((function(n){n.dialCode==e&&(t=n.iso2)})),t),separateDialCode:!0,autoHideDialCode:!0,nationalMode:!1});a.addEventListener("countrychange",(function(){s.getSelectedCountryData().dialCode&&$("#sln_customer_meta__sln_sms_prefix").val("+"+s.getSelectedCountryData().dialCode)})),a.addEventListener("blur",(function(){s.getSelectedCountryData().dialCode&&$("#sln_customer_meta__sln_phone").val($("#sln_customer_meta__sln_phone").val().replace("+"+s.getSelectedCountryData().dialCode,""))}))}if((a=document.querySelector("#_sln_attendant_phone"))&&$("#_sln_attendant_sms_prefix").length){function o(e){var n=window.intlTelInputGlobals.getCountryData(),t="";return n.forEach((function(n){n.dialCode==e&&(t=n.iso2)})),t}s=window.intlTelInput(a,{initialCountry:o(($("#_sln_attendant_sms_prefix").val()||"").replace("+","")),separateDialCode:!0,autoHideDialCode:!0,nationalMode:!1});a.addEventListener("countrychange",(function(){s.getSelectedCountryData().dialCode&&$("#_sln_attendant_sms_prefix").val("+"+s.getSelectedCountryData().dialCode)})),a.addEventListener("blur",(function(){s.getSelectedCountryData().dialCode&&$("#_sln_attendant_phone").val($("#_sln_attendant_phone").val().replace("+"+s.getSelectedCountryData().dialCode,""))}))}$("#sln-booking-editor-modal").on("shown.bs.modal",(function(e){$(this).find("iframe").on("load",(function(){$(this).contents().find("body").addClass("inmodal")}))})),$(".sln-booking-confirmation .sln-booking-confirmation-success, .sln-booking-confirmation .sln-booking-confirmation-error").on("click",(function(){var e=$(this);return e.closest(".sln-booking-confirmation-disabled").length||(e.closest(".sln-booking-confirmation").find(".sln-booking-confirmation-alert-loading").html(e.attr("title")).addClass(e.data("class")),e.closest(".sln-booking-confirmation").addClass("loading"),jQuery.ajax({url:ajaxurl,type:"POST",data:{action:"salon",method:"setBookingStatus",status:e.data("status"),booking_id:e.data("booking-id")},cache:!1,dataType:"json",success:function(n){e.closest("tr").find(".booking_status").html(n.status),e.closest("td").html("")}})),!1})),$("#_sln_booking_status").on("change",(function(){var e=$(this).closest(".row").find(".sln-set-default-booking-status--block-labels").data("defaultStatus");$(this).val()!==e?($(".sln-set-default-booking-status--label-set").removeClass("hide"),$(this).closest(".row").find(".select2-selection__rendered").removeClass("sln-booking-default-status")):($(".sln-set-default-booking-status--label-set").addClass("hide"),$(this).closest(".row").find(".select2-selection__rendered").addClass("sln-booking-default-status"))})).trigger("change"),$(".sln-set-default-booking-status--label-set").on("click",(function(){if($(this).closest(".sln-set-default-booking-status--block-label-disabled").length)return!1;var e=$("#_sln_booking_status").val(),n=$(this);return n.addClass("hide"),n.closest(".sln-set-default-booking-status--block-labels").find(".sln-set-default-booking-status--alert-loading").removeClass("hide"),jQuery.ajax({url:ajaxurl,type:"POST",data:{action:"salon",method:"setDefaultBookingStatus",status:e},cache:!1,dataType:"json",success:function(t){n.closest(".sln-set-default-booking-status--block-labels").data("defaultStatus",e);var a=n.closest(".sln-set-default-booking-status--block-labels").find(".sln-set-default-booking-status--label-done");a.removeClass("hide"),setTimeout((function(){a.addClass("hide")}),3e3),$("#_sln_booking_status").trigger("change"),n.closest(".sln-set-default-booking-status--block-labels").find(".sln-set-default-booking-status--alert-loading").addClass("hide")}}),!1})),$(".generate-onesignal-app").on("click",(function(e){$(this).addClass("loading");var n=this;return jQuery.ajax({url:ajaxurl,type:"POST",data:{action:"salon",method:"GenerateOnesignalApp"},cache:!1,dataType:"json",success:function(e){$(n).removeClass("loading"),$("#salon_settings_onesignal_app_id").val(e.app_id)}}),!1})),$(".sln-select--multiple--search").length&&$(".sln-select--multiple--search select").each((function(){jQuery(this).on("select2:closing",(function(e){jQuery(this).parent().find(".select2-selection__rendered .select2-selection__choice").length?jQuery(this).closest(".sln-select--inwrapper").removeClass("has_no_choices"):jQuery(this).closest(".sln-select--inwrapper").addClass("has_no_choices")}))}))}));